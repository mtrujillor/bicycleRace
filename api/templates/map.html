<!DOCTYPE html>
<html>
<head>
<title>       </title>
</head>
<body>
	<nav class="navbar navbar-default">
	  <div class="container">
	    <div class="navbar-header">
	      <a class="navbar-brand" href="#">
	        CICLOVIA TESTAPP
	      </a>
	    </div>
	  </div>
	</nav>
	<div class="container">
		<div class="col-sm-6" style="height:700px">
		    <div id="mapOrigin" class="well"></div>
		</div>
		<div class="col-sm-6">
		    <form role="form">
		    	<div class="col-sm-12">
				  <h4>Filtrar</h4>
				  </div>
				  <div class="col-sm-6">
				  	<div class="form-group">
					    <label for="age_start">Edad mínima:</label>
					    <input type="number" class="form-control" name="age_start" id="age_start" value=0>
					  </div>
					  <div class="form-group">
					  	<label for="datetimepicker1">Fecha mínima:</label>
              <div class='input-group date' id='datetimepicker1'>
                <input type='text' name="date_start" class="form-control" value="10/05/2015 7:00" />
                <span class="input-group-addon">
                  <span class="glyphicon glyphicon-calendar"></span>
                </span>
              </div>
            </div>
					  <div class="form-group">
					    <label for="activity">Actividad:</label>
					    <select class="form-control" name="activity" id="activity">
					    	<option value="">Todos</option>
							  <option value="bike riding">Bicicleta</option>
							  <option value="jogging">Trote</option>
							  <option value="walking">Caminata</option>
							  <option value="skating">Patines</option>
							  <option value="other">Otros</option>
							</select>
					  </div>
					  <div class="form-group">
					    <label for="gender">Género:</label>
					    <select class="form-control" name="gender" id="gender">
					    	<option value="">N/A</option>
							  <option value="male">Hombre</option>
							  <option value="female">Mujer</option>
							</select>
					  </div>
				  </div>
				  <div class="col-sm-6">
					  <div class="form-group">
					    <label for="age_end">Edad máxima:</label>
					    <input type="number" class="form-control" name="age_end" id="age_end" value=90>
					  </div>
					  <div class="form-group">
					  	<label for="datetimepicker2">Fecha máxima:</label>
              <div class='input-group date' id='datetimepicker2'>
                <input type='text' name="date_end" class="form-control" value="10/05/2015 14:00" />
                <span class="input-group-addon">
                  <span class="glyphicon glyphicon-calendar"></span>
                </span>
              </div>
            </div>
            <div class="form-group">
					    <label for="healthRisk">Problemas de Salud:</label>
					    <select class="form-control" name="healthRisk" id="healthRisk">
					    	<option value="">Todos</option>
							  <option value="cardiovascular">Cardiovascular</option>
							  <option value="breathing">Respiratorio</option>
							  <option value="infectious">Infeccioso</option>
							  <option value="bones joints muscles">Huesos, articulaciones y músculos</option>
							  <option value="other">Otros</option>
							</select>
					  </div>
					</div>
					<div class="col-sm-12">
						<button type="submit" class="btn btn-default">Submit</button>
					</div>
				</form>
		</div>
  </div>

<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.4/sandstone/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/css/bootstrap-datetimepicker.css" />
<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDY0kkJiTPVd2U7aTOAwhc9ySH6oHxOIYM&sensor=false"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment-with-locales.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript">
            $(function () {
                $('#datetimepicker1').datetimepicker({
                    locale: 'es'
                });
                $('#datetimepicker2').datetimepicker({
                    locale: 'es'
                });
            });
        </script>
<script>

    //Google maps
    var initialize;
    initialize = function() {
        infowindow = new google.maps.InfoWindow();
        var latlngOrigin = new google.maps.LatLng(4.714179, -74.032584);

        var originProp = {
            disableDefaultUI: true,
            zoomControl: true,
            zoomControlOptions: {
                style: google.maps.ZoomControlStyle.DEFAULT,
                position: google.maps.ControlPosition.RIGHT_TOP
            },
            center: latlngOrigin,
            zoom: 15,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var mapOrigin = new google.maps.Map(document.getElementById("mapOrigin"), originProp);
        $("#mapTab").on('shown.bs.tab', function() {

            /* Trigger map resize event */
            google.maps.event.trigger(mapOrigin, 'resize');
            mapOrigin.setCenter(latlngOrigin);
        });

        $("#mapOrigin").css("width", '100%').css("height", '100%');

        var json = getFilteredUsers();
        var locs = 0;
        for (var i = 0; i < json.length; i++) {
            var user = json[i];
            var id = user['_id']['$oid'];
            var locations = user['locations'];
            var color = getRandomColor();
            for (var j = 0; j < locations.length; j++) {
            	var coordinates = locations[j]['coordinates']['coordinates'];
            	var date = new Date(locations[j]['createdAt']['$date']);
            	var latLng = new google.maps.LatLng(coordinates[0],coordinates[1]);
            	var markerOrigin = new google.maps.Marker({
		            position: latLng,
		            map: mapOrigin,
		            draggable:false,
		            icon: pinSymbol(color),
		            title: 'Date: '+date.toUTCString()
		        });
            }
        }

        function getRandomColor() {
		    var letters = '0123456789ABCDEF'.split('');
		    var color = '#';
		    for (var i = 0; i < 6; i++ ) {
		        color += letters[Math.floor(Math.random() * 16)];
		    }
		    return color;
		}

        
        function pinSymbol(color) {
            return {
                path: 'M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z',
                fillColor: color,
                fillOpacity: 1,
                strokeColor: '#000',
                strokeWeight: 2,
                scale: 1
            };
        }

    }

    function getFilteredUsers() {
        return JSON.parse(getUsers(qs));
    }

    /*Grab the website parameters*/
    var qs = (function(a) {
	    if (a == "") return {};
	    var b = {};
	    for (var i = 0; i < a.length; ++i)
	    {
	        var p=a[i].split('=', 2);
	        if (p.length == 1)
	            b[p[0]] = "";
	        else
	            b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
	    }
	    return b;
		})(window.location.search.substr(1).split('&'));

		/*Get information for a workspace*/
    function getUsers(params) {
        return $.ajax({
          type: "GET",
          async:false,
          dataType: "json",
          url: "/users",
          dataType: "JSON",
          data: params,
        }).responseText;
    }

    google.maps.event.addDomListener(window, 'load', initialize);

</script>
</body>
</html>
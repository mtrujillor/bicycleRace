<html>
<head>
<title>       </title>
</head>
<body>
	<nav class="navbar navbar-default">
	  <div class="container-fluid">
	    <div class="navbar-header">
	      <a class="navbar-brand" href="#">
	        Test!
	      </a>
	    </div>
	  </div>
	</nav>
	<div class="container">
		<div class="col-sm-6">
		    <div id="mapOrigin" class="well"></div>
		</div>
		<div class="col-sm-6">
		    Espacio para otras cosas
		</div>
    </div>



<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.4/sandstone/bootstrap.min.css" rel="stylesheet">
<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDY0kkJiTPVd2U7aTOAwhc9ySH6oHxOIYM&sensor=false">
</script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js">
</script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js">
</script>
<script>

    /*Get information for a workspace*/
    function getUsers() {
        return $.ajax({
          type: "GET",
          async:false,
          dataType: "json",
          url: "/users",
          dataType: "JSON",
        }).responseText;
    }

    //Google maps
    var initialize;
    initialize = function() {
        infowindow = new google.maps.InfoWindow();
        var latlngOrigin = new google.maps.LatLng(4.714179, -74.032584);

        var originProp = {
            disableDefaultUI: true,
            zoomControl: true,
            zoomControlOptions: {
                style: google.maps.ZoomControlStyle.DEFAULT,
                position: google.maps.ControlPosition.RIGHT_TOP
            },
            center: latlngOrigin,
            zoom: 15,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var mapOrigin = new google.maps.Map(document.getElementById("mapOrigin"), originProp);
        $("#mapTab").on('shown.bs.tab', function() {

            /* Trigger map resize event */
            google.maps.event.trigger(mapOrigin, 'resize');
            mapOrigin.setCenter(latlngOrigin);
        });

        $("#mapOrigin").css("width", '100%').css("height", '100%');

        var json = JSON.parse(getUsers());
        var locs = 0;
        for (var i = 0; i < json.length; i++) {
            var user = json[i];
            var id = user['_id']['$oid'];
            var locations = user['locations'];
            var color = getRandomColor();
            for (var j = 0; j < locations.length; j++) {
            	var coordinates = locations[j]['coordinates']['coordinates'];
            	var date = new Date(locations[j]['createdAt']['$date']);
            	var latLng = new google.maps.LatLng(coordinates[0],coordinates[1]);
            	var markerOrigin = new google.maps.Marker({
		            position: latLng,
		            map: mapOrigin,
		            draggable:false,
		            icon: pinSymbol(color),
		            title: 'Date: '+date.toUTCString()
		        });
            }
        }

        function getRandomColor() {
		    var letters = '0123456789ABCDEF'.split('');
		    var color = '#';
		    for (var i = 0; i < 6; i++ ) {
		        color += letters[Math.floor(Math.random() * 16)];
		    }
		    return color;
		}

        
        function pinSymbol(color) {
            return {
                path: 'M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z',
                fillColor: color,
                fillOpacity: 1,
                strokeColor: '#000',
                strokeWeight: 2,
                scale: 1
            };
        }

    }
    google.maps.event.addDomListener(window, 'load', initialize);

</script>
</body>
</html>